/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function d(d,e){var f=function(a){return new CKEDITOR.dom.element(a,d.document)},g=d.plugins.dialogadvtab;return{title:d.lang.table.title,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,onLoad:function(){var a=this,b=a.getContentElement("advanced","advStyles");b&&b.on("change",function(b){var c=this.getStyle("width",""),d=a.getContentElement("info","txtWidth"),e=a.getContentElement("info","cmbWidthType"),f=1;c&&(f=c.length<3||c.substr(c.length-1)!="%",c=parseInt(c,10)),d&&d.setValue(c,!0),e&&e.setValue(f?"pixels":"percents",!0);var g=this.getStyle("height",""),h=a.getContentElement("info","txtHeight");g&&(g=parseInt(g,10)),h&&h.setValue(g,!0)})},onShow:function(){var a=this,b=d.getSelection(),c=b.getRanges(),f=null,g=a.getContentElement("info","txtRows"),h=a.getContentElement("info","txtCols"),i=a.getContentElement("info","txtWidth"),j=a.getContentElement("info","txtHeight");if(e=="tableProperties"){if(f=b.getSelectedElement())f=f.getAscendant("table",!0);else if(c.length>0){CKEDITOR.env.webkit&&c[0].shrink(CKEDITOR.NODE_ELEMENT);var k=c[0].getCommonAncestor(!0);f=k.getAscendant("table",!0)}a._.selectedElement=f}f?(a.setupContent(f),g&&g.disable(),h&&h.disable()):(g&&g.enable(),h&&h.enable()),i&&i.onChange(),j&&j.onChange()},onOk:function(){var a=this;if(a._.selectedElement)var b=d.getSelection(),c=b.createBookmarks();var e=a._.selectedElement||f("table"),g=a,h={};a.commitContent(h,e);if(h.info){var i=h.info;if(!a._.selectedElement){var j=e.append(f("tbody")),k=parseInt(i.txtRows,10)||0,l=parseInt(i.txtCols,10)||0;for(var m=0;m<k;m++){var n=j.append(f("tr"));for(var o=0;o<l;o++){var p=n.append(f("td"));CKEDITOR.env.ie||p.append(f("br"))}}}var q=i.selHeaders;if(!e.$.tHead&&(q=="row"||q=="both")){var r=new CKEDITOR.dom.element(e.$.createTHead());j=e.getElementsByTag("tbody").getItem(0);var s=j.getElementsByTag("tr").getItem(0);for(m=0;m<s.getChildCount();m++){var t=s.getChild(m);t.type==CKEDITOR.NODE_ELEMENT&&!t.data("cke-bookmark")&&(t.renameNode("th"),t.setAttribute("scope","col"))}r.append(s.remove())}if(e.$.tHead!==null&&q!="row"&&q!="both"){r=new CKEDITOR.dom.element(e.$.tHead),j=e.getElementsByTag("tbody").getItem(0);var u=j.getFirst();while(r.getChildCount()>0){s=r.getFirst();for(m=0;m<s.getChildCount();m++){var v=s.getChild(m);v.type==CKEDITOR.NODE_ELEMENT&&(v.renameNode("td"),v.removeAttribute("scope"))}s.insertBefore(u)}r.remove()}if(!a.hasColumnHeaders&&(q=="col"||q=="both"))for(n=0;n<e.$.rows.length;n++)v=new CKEDITOR.dom.element(e.$.rows[n].cells[0]),v.renameNode("th"),v.setAttribute("scope","row");if(a.hasColumnHeaders&&q!="col"&&q!="both")for(m=0;m<e.$.rows.length;m++)n=new CKEDITOR.dom.element(e.$.rows[m]),n.getParent().getName()=="tbody"&&(v=new CKEDITOR.dom.element(n.$.cells[0]),v.renameNode("td"),v.removeAttribute("scope"));var w=[];i.txtHeight?e.setStyle("height",CKEDITOR.tools.cssLength(i.txtHeight)):e.removeStyle("height");if(i.txtWidth){var x=i.cmbWidthType||"pixels";e.setStyle("width",i.txtWidth+(x=="pixels"?"px":"%"))}else e.removeStyle("width");e.getAttribute("style")||e.removeAttribute("style")}return a._.selectedElement?b.selectBookmarks(c):d.insertElement(e),!0},contents:[{id:"info",label:d.lang.table.title,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":3,label:d.lang.table.rows,required:!0,style:"width:5em",validate:function(){var a=!0,b=this.getValue();return a=a&&CKEDITOR.dialog.validate.integer()(b)&&b>0,a||(alert(d.lang.table.invalidRows),this.select()),a},setup:function(a){this.setValue(a.$.rows.length)},commit:c},{type:"text",id:"txtCols","default":2,label:d.lang.table.columns,required:!0,style:"width:5em",validate:function(){var a=!0,b=this.getValue();return a=a&&CKEDITOR.dialog.validate.integer()(b)&&b>0,a||(alert(d.lang.table.invalidCols),this.select()),a},setup:function(a){this.setValue(a.$.rows[0].cells.length)},commit:c},{type:"html",html:"&nbsp;"},{type:"select",id:"selHeaders","default":"",label:d.lang.table.headers,items:[[d.lang.table.headersNone,""],[d.lang.table.headersRow,"row"],[d.lang.table.headersColumn,"col"],[d.lang.table.headersBoth,"both"]],setup:function(a){var b=this.getDialog();b.hasColumnHeaders=!0;for(var c=0;c<a.$.rows.length;c++)if(a.$.rows[c].cells[0].nodeName.toLowerCase()!="th"){b.hasColumnHeaders=!1;break}a.$.tHead!==null?this.setValue(b.hasColumnHeaders?"both":"row"):this.setValue(b.hasColumnHeaders?"col":"")},commit:c},{type:"text",id:"txtBorder","default":1,label:d.lang.table.border,style:"width:3em",validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidBorder),setup:function(a){this.setValue(a.getAttribute("border")||"")},commit:function(a,b){this.getValue()?b.setAttribute("border",this.getValue()):b.removeAttribute("border")}},{id:"cmbAlign",type:"select","default":"",label:d.lang.common.align,items:[[d.lang.common.notSet,""],[d.lang.common.alignLeft,"left"],[d.lang.common.alignCenter,"center"],[d.lang.common.alignRight,"right"]],setup:function(a){this.setValue(a.getAttribute("align")||"")},commit:function(a,b){this.getValue()?b.setAttribute("align",this.getValue()):b.removeAttribute("align")}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",style:"width:5em",label:d.lang.common.width,"default":500,validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidWidth),onLoad:function(){var a=this.getDialog().getContentElement("info","cmbWidthType"),b=a.getElement(),c=this.getInputElement(),d=c.getAttribute("aria-labelledby");c.setAttribute("aria-labelledby",[d,b.$.id].join(" "))},onChange:function(){var a=this.getDialog().getContentElement("advanced","advStyles");if(a){var b=this.getValue();b&&(b+=this.getDialog().getContentElement("info","cmbWidthType").getValue()=="percents"?"%":"px"),a.updateStyle("width",b)}},setup:function(b){var c=a.exec(b.$.style.width);c?this.setValue(c[1]):this.setValue("")},commit:c},{id:"cmbWidthType",type:"select",label:d.lang.table.widthUnit,labelStyle:"visibility:hidden","default":"pixels",items:[[d.lang.table.widthPx,"pixels"],[d.lang.table.widthPc,"percents"]],setup:function(b){var c=a.exec(b.$.style.width);c&&this.setValue(c[2]=="px"?"pixels":"percents")},onChange:function(){this.getDialog().getContentElement("info","txtWidth").onChange()},commit:c}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",style:"width:5em",label:d.lang.common.height,"default":"",validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidHeight),onLoad:function(){var a=this.getDialog().getContentElement("info","htmlHeightType"),b=a.getElement(),c=this.getInputElement(),d=c.getAttribute("aria-labelledby");c.setAttribute("aria-labelledby",[d,b.$.id].join(" "))},onChange:function(){var a=this.getDialog().getContentElement("advanced","advStyles");if(a){var b=this.getValue();a.updateStyle("height",b&&b+"px")}},setup:function(a){var c=b.exec(a.$.style.height);c&&this.setValue(c[1])},commit:c},{id:"htmlHeightType",type:"html",html:"<div><br />"+d.lang.table.widthPx+"</div>"}]},{type:"html",html:"&nbsp;"},{type:"text",id:"txtCellSpace",style:"width:3em",label:d.lang.table.cellSpace,"default":1,validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidCellSpacing),setup:function(a){this.setValue(a.getAttribute("cellSpacing")||"")},commit:function(a,b){this.getValue()?b.setAttribute("cellSpacing",this.getValue()):b.removeAttribute("cellSpacing")}},{type:"text",id:"txtCellPad",style:"width:3em",label:d.lang.table.cellPad,"default":1,validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidCellPadding),setup:function(a){this.setValue(a.getAttribute("cellPadding")||"")},commit:function(a,b){this.getValue()?b.setAttribute("cellPadding",this.getValue()):b.removeAttribute("cellPadding")}}]}]},{type:"html",align:"right",html:""},{type:"vbox",padding:0,children:[{type:"text",id:"txtCaption",label:d.lang.table.caption,setup:function(a){var b=a.getElementsByTag("caption");if(b.count()>0){var c=b.getItem(0);c=CKEDITOR.tools.trim(c.getText()),this.setValue(c)}},commit:function(a,b){var c=this.getValue(),e=b.getElementsByTag("caption");if(c)e.count()>0?(e=e.getItem(0),e.setHtml("")):(e=new CKEDITOR.dom.element("caption",d.document),b.getChildCount()?e.insertBefore(b.getFirst()):e.appendTo(b)),e.append(new CKEDITOR.dom.text(c,d.document));else if(e.count()>0)for(var f=e.count()-1;f>=0;f--)e.getItem(f).remove()}},{type:"text",id:"txtSummary",label:d.lang.table.summary,setup:function(a){this.setValue(a.getAttribute("summary")||"")},commit:function(a,b){this.getValue()?b.setAttribute("summary",this.getValue()):b.removeAttribute("summary")}}]}]},g&&g.createAdvancedTab(d)]}}var a=/^(\d+(?:\.\d+)?)(px|%)$/,b=/^(\d+(?:\.\d+)?)px$/,c=function(a){var b=this.id;a.info||(a.info={}),a.info[b]=this.getValue()};CKEDITOR.dialog.add("table",function(a){return d(a,"table")}),CKEDITOR.dialog.add("tableProperties",function(a){return d(a,"tableProperties")})})()