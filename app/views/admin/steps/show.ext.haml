- nodes, name, type = case @node
  - when Tournament: [:steps, 'Сезон', 'StepSeason']
  - when StepSeason: [:steps, 'Этап', 'StepStage']
  - when StepTour: [:matches, 'Матч', 'Match']
  - when StepStage
  - case params[:type]
    - when 'leagues': [:leagues, 'Лигу', 'StepLeague']
    - when 'tours': [:tours, 'Тур', 'StepTour']
    - else [[{:text => 'Лиги', :cls => 'folder', :id => "nav-tournament-#{@node.id}-leagues"}, {:text => 'Туры', :cls => 'folder', :id => "nav-tournament-#{@node.id}-tours"}], nil, nil]
- unless type.nil?
  - nodes = @node.send(nodes).map do |s|
    - {:text => s.full_name, :cls => params['type'] == 'leagues' ? 'league' : 'folder', :id => "nav-tournament-#{s.id}", :leaf => params['type'] == 'leagues', '_id' => s.id, '_identifier' => s.identifier, '_name' => s.name, '_url' => s.url, '_type' => s.type}
  - id = "nav-tournament-add-to-#{params[:id] || 'root'}"
  - id << "-#{params[:type]}" if params[:type]
  - nodes.push(:text => 'Добавить ' + name, :cls => 'add', :id => id, :leaf => true, :draggable => false, '_type' => type, '_owner_id' => params[:id] || 'root')
= nodes.to_json